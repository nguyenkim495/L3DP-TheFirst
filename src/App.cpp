#include <time.h>

#include "App.h"
#include <Game.h>


using namespace irr;


App* App::m_Instance = 0;
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void App::CreatApplication()
{
	m_Instance = new App();
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
App* App::GetInstance()
{
	return m_Instance;
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void App::Init()
{
	delta = 0.0f;
	//m_game = new Game();
	//m_game->Init(m_DEVICE);
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void App::Destroy()
{
	//delete m_Instance;
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void App::Render()
{
	m_game->Render();
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void App::Update()
{
	time_t timeNow = time(0);

	//if(!m_game)// == nullptr)
	{
		m_game = new Game();
		m_game->Init(m_DEVICE);
	}

	m_game->Update(delta);

	delta = time(0) - timeNow;
}
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//bool App::OnEvent(irr::SEvent& event)
//{
//
//}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void App::onKeyEvent(irr::EKEY_CODE keyCode)
{
	Game::Instance()->OnKeyEvent(keyCode);
}

//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
void App::onMouseEvent(irr::EMOUSE_INPUT_EVENT mouseCode)
{
	Game::Instance()->OnMouseEvent(mouseCode);
}

//#pragma comment(lib, "irrKlang.lib") //prefer setting in Game_2012/properties/Linker/Input/Additional Dependencies
//////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
//WIN32
int main(int argc, char** argv) //lol this function, cant run as name Main
{
	App* m_AppGlobal = new App();
	irr::IrrlichtDevice* DEVICE = createDevice(video::EDT_OPENGL, core::dimension2d<u32>(Screen::SCREEN_WIDTH, Screen::SCREEN_HEIGHT), 32, false, false, true, m_AppGlobal);

	m_AppGlobal->CreatApplication();
	m_AppGlobal->GetInstance()->m_DEVICE = DEVICE;
	m_AppGlobal->GetInstance()->m_DRIVER = DEVICE->getVideoDriver();
	m_AppGlobal->GetInstance()->m_SMGR = DEVICE->getSceneManager();
	m_AppGlobal->GetInstance()->Init();

	DEVICE->setResizable(false);
	m_AppGlobal->GetInstance()->m_DRIVER->beginScene(true, true, video::SColor(255, 255, 255, 255));

	while (m_AppGlobal->GetInstance()->m_DEVICE->run())
	{
		m_AppGlobal->Update();
	}

	delete m_AppGlobal;

	return 0;
}